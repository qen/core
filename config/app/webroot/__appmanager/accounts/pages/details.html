<% extends 'skin/appmanager.html' %>

<% block header %>
<script type="text/javascript" src="<%= Uri.root %>js/mootools/wysiwyg/wysiwyg.js"></script>
<link rel="stylesheet" href="<%= Uri.root %>js/mootools/wysiwyg/style.css" type="text/css" />

<% endblock %>

<% block jsinline %>
<script language="javascript" >
var DW = null;
function validateRelUrl(el) {
  var check = el.value;
  //var re = /^(http|https|ftp)\:\/\/[a-z0-9\-\.]+\.[a-z]{2,3}(:[a-z0-9]*)?\/?([a-z0-9\-\._\?\,\'\/\\\+&amp;%\$#\=~])*$/i
  var re = /^((http|https|ftp)\:\/\/[a-z0-9\-\.]+\.[a-z]{2,3}(:[a-z0-9]*)?)?\/([a-z0-9\-\._\?\,\'\/\\\+&amp;%\$#\=~])+$/i

  if (!re.test(check)) {
    el.errors.push( 'Please enter a valid url' );
    el.errors.push( 'Example:' );
    el.errors.push( '/my-valid/url-page' );
    el.errors.push( 'http://www.example.com/my-valid/url-page' );
    return false;
  }
  return true;
}//end function
</script>
<% endblock %>

<% block jsdomready %>
<script language="javascript" >

$$('input.typestat').each(function(el){
    if (el.get('value') & appvar.page.typestat )
      el.fireEvent('click').setProperty('checked', true);
});

DW = new wysiwyg({
	textarea: $('wysiwyg').getElement('textarea')
});
</script>

<% endblock %>

<% block contentname %>Pages<% endblock %>
<% block menu %>
  <h3>Page</h3>
  <a href="<%= Uri.path %>/add">Add</a>
  <a href="<%= Uri.path %>">Search</a>
  <% if details.pageid %>
  <a class="ConfirmBox" href="<%= Uri.path %>/<%= details.pageid %>/delete" title="Continue to Delete Page Post?" style="color:#ccc;" >Delete</a>
  <% endif %>
<% endblock %>

<% block body %><a name="top"></a>
    <form class="form FormCheck" action="<%= Uri.path %>/save" method="post" enctype="multipart/form-data" autocomplete="off">
      <input name="d[pageid]" value="<%= details.pageid|default(0) %>" type="hidden" />
      <input name="d[page_typestat][]" value="0" type="hidden" />
        <h3>
        <%= details.pageid ? 'Page #' ~ details.pageid : 'Add Page' %>
        </h3>
        <hr>

        <label class="required">URL<em>Relative Url must start with /</em></label>
        <input name="d[page_url]" type="text" value="<%= details.page_url|default('/') %>" class="validate['required','~validateRelUrl']"  /><br />

        <label class="">Group<em></em></label>
        <input name="d[page_group]" value="<%= details.page_group %>" type="text"  maxlength="100"><br />

        <label class="">Sort<em></em></label>
        <input name="d[page_sort]" value="<%= details.page_sort|default(0) %>" type="text"  maxlength="100">
        <br/><br />

        <label class="required">Title</label>
        <input name="d[page_title]" value="<%= details.page_title %>" type="text"  class="validate['required'] " maxlength="100">
        <br/>

        <label>Description<em></em></label>
        <textarea name="d[page_descr]" style="width: 240px; height: 100px;"><%= details.page_descr %></textarea><br />

        <label>Settings </label><div class="fL">
          <input name="d[page_typestat][]" value="1" class="left typestat" id="typebit1" type="checkbox"><label class="left normal" for="typebit1" style="">Show</label><br>
          <input name="d[page_typestat][]" value="128" class="left typestat" id="typebit2" type="checkbox"><label class="left normal" for="typebit2" style="">Simplage Page</label><br>
          <input name="d[page_typestat][]" value="256" class="left typestat" id="typebit3" type="checkbox"><label class="left normal" for="typebit3" style="">Featured Page</label><br>
        </div><br /><br />

        <h3>Page Configuration</h3>
        <hr/>
        <label class="left" ><em>YAML Config</em></label><br />
        <textarea name="d[page_settings]" cols="80" rows="24" style="width:100%; font-family:'Courier New', Courier, monospace"><%= details.page_settings %></textarea>
        <br />
        <hr>
        <input value="Save" type="submit" class="">
        <br />
        <br />
        <br />
        <h3>Page Details</h3>
        <hr/>
        <br />
        
        <div class="weezee" id="wysiwyg">
            <textarea class="" name="d[page_details]" rows="5" cols="30"><%= details.page_details %></textarea>
        </div>
        <br />
        <input value="Save" type="submit" class="">
        <br />
        <br>
        <br>
        <sup class="fR"><a href="#top" class="SmoothScroll" style="font-size:10px">Top</a><a name="metatags"></a></sup>
        <h3>Page SEO</h3>
        <hr/>
        <br />
        <label class="" >Page Title</label>
        <input name="d[Metatags][page_title]" type="text" value="<%= details.Metatags.page_title|default(details.page_title) %>" /><br />
        
        <label class="" >Meta tag  Title</label>
        <input name="d[Metatags][meta_title]" type="text" value="<%= details.Metatags.meta_title %>" /><br />

        <label class="" >Meta tag Description</label>
        <input name="d[Metatags][meta_descr]" type="text" value="<%= details.Metatags.meta_descr %>" /><br />

        <label class="" >Meta tag Keywords</label>
        <input name="d[Metatags][meta_keywords]" type="text" value="<%= details.Metatags.meta_keywords %>" /><br />

        <label class="" >Analytics</label>
        <textarea name="d[Metatags][meta_analytics]" style="width: 240px; height: 180px;"><%= details.Metatags.meta_analytics %></textarea><br />
        
        <br />
        <hr>
        <input value="Save" type="submit" class="">
        <br />
        <br />
        <br />

        <br />
        <br />
    </form>

<div class="appvar"><% spaceless %>{
page : {
    typestat: <%= details.page_typestat|default(0) %>
}
}<% endspaceless %></div>
<% endblock %>
