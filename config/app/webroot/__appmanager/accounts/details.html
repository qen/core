<% extends 'skin/appmanager.html' %>
<% block header %>
<link href="<%= Uri.root %>js/mootools/DatePicker/datepicker_vista/datepicker_vista.css" rel="stylesheet" type="text/css" media="screen">
<script src="<%= Uri.root %>js/mootools/DatePicker/DatePicker.js" type="text/javascript"></script>

<link href="<%= Uri.root %>js/mootools/squeezebox/assets/SqueezeBox.css" rel="stylesheet" type="text/css" />
<script src="<%= Uri.root %>js/mootools/squeezebox/SqueezeBox.js" type="text/javascript"></script>

<style type="text/css">
<% filter cssminify|raw %>
a.page {
    background:none repeat scroll 0 0 #FBFBF3;
    border:1px solid #CCCCCC;
    color:#888888;
    margin:10px auto;
    padding:8px;
    width:540px;
    font-family: Georgia,"Times New Roman";
    font-size: 18px;
    display:block;
    position:relative;

}
a.page:hover{
    border:1px solid #ff9900;
    text-decoration: none;
}
a.page p {
    font-size: 12px;
}
a.page:hover h5 {
  text-decoration: underline;
}
<% endfilter %>
</style>
<% endblock %>

<% block jsdomready %>
<script language="javascript" >
  $$('input.DatePicker').each(function(el){
      el.set('readonly', true);
      new DatePicker(el,{
          pickerClass: 'datepicker_vista',
          timePicker: false,
          //format: '%b %d, %Y %I:%M %p',
          format: '%b %d, %Y',
          startDay: 0
      });
  });

  SqueezeBox.initialize({
      size: {x: 590, y: 370}
  });

  SqueezeBox.assign($$('a.SqueezeBox'), {});

  $$('input.typestat').each(function(el){
      if (el.get('value') & appvar.account.typestat )
          el.fireEvent('click').setProperty('checked', true);
  });
</script>
<% endblock %>


<% block contentname %>Account<% endblock %>
<% block menu %>
  <h3>Account</h3>
  <a href="<%= Uri.path %>/add">Add</a>
  <a href="<%= Uri.path %>">Search</a>
  <% if details.accountid %>
  <a class="ConfirmBox" href="<%= Uri.path %>/delete/<%= details.accountid %>" title="Continue to Delete Account?" style="color:#ccc;" >Delete</a>
  <a class="SmoothScroll" href="#access">Account Access</a>
  <a class="" href="<%= Uri.path %>/<%= details.accountid %>/properties">Properties</a>
  <a class="" href="<%= Uri.path %>/<%= details.accountid %>/realtors">Realtors</a>
  <a class="" href="<%= Uri.path %>/<%= details.accountid %>/blogs">Blogs</a>
  <a class="" href="<%= Uri.path %>/<%= details.accountid %>/pages">CMS</a>
  <% endif %>
<% endblock %>

<% block body %>
    <% import 'inc/account/selects.html' as selects %>
    
    <form class="form FormCheck" action="<%= Uri.path %>/save" method="post" enctype="multipart/form-data" autocomplete="off">
      <input name="d[accountid]" value="<%= details.accountid %>" type="hidden" />
      <input name="d[User][userid]" value="<%= details.User.userid %>" type="hidden" />
      <input name="d[acnt_typestat][]" value="0" type="hidden" />
      <h3><a name="top"></a>
      <%= details.accountid ? 'Account ID #' ~ details.accountid : 'Add Account' %>
      </h3>
      <hr>

      <label class="required" >First Name</label>
      <input name="d[acnt_name]" type="text" value="<%= details.acnt_name %>"  class="validate['required'] " /><br />

      <label class="required" >Last Name</label>
      <input name="d[acnt_name_suffix]" type="text" value="<%= details.acnt_name_suffix %>"  class="validate['required'] " /><br />

      <label class="required">Birthday</label>
      <input name="d[acnt_date_birth]" type="text" value="<%= details.acnt_date_birth|default('Jan 01, 1980')|date('M d, Y') %>" class="DatePicker validate['required']"  /><br />
      <br />

      <label class="required" >Username</label>
      <input name="d[User][usr_username]" type="text" value="<%= details.User.usr_username %>"  class="validate['required'] " /><br />

      <label class="required" >Password</label>
      <input name="d[User][usr_password]" type="text" value="<%= details.User.usr_password %>"  class="validate['required'] " /><br />

      <label class="required" >Email</label>
      <input name="d[User][usr_email]" type="text" value="<%= details.User.usr_email %>"  class="validate['required'] " /><br />

      <br />
      <label class="" >Type / Status</label> <div class="fL" style="width:300px">
          <input name="d[acnt_typestat][]" value="1" type="checkbox" class="left typestat" id="typebit1"  /><label class="left normal" for="typebit1" >Active</label><br />
          <input name="d[acnt_typestat][]" value="2" type="checkbox" class="left typestat" id="typebit2"  /><label class="left normal" for="typebit2" >Customer</label><br />
          <input name="d[acnt_typestat][]" value="4" type="checkbox" class="left typestat" id="typebit4"  /><label class="left normal" for="typebit4" >Partner</label><br />
          <input name="d[acnt_typestat][]" value="8" type="checkbox" class="left typestat" id="typebit8"  /><label class="left normal" for="typebit8" >Support</label><br />          
      </div><br />
      <br />

      <label class="" >Address</label>
      <div class="fL">
          <input name="d[acnt_street1]" type="text" value="<%= details.acnt_street1 %>" /><br />
          <input name="d[acnt_street2]" type="text" value="<%= details.acnt_street2 %>" />
      </div><br />

      <label class="" >City</label>
      <input name="d[acnt_city]" type="text" value="<%= details.acnt_city %>" /><br />

      <label class="" >State</label>
      <input name="d[acnt_state]" type="text" value="<%= details.acnt_state %>" /><br />

      <label class="" >Zipcode</label>
      <input name="d[acnt_zipcode]" type="text" value="<%= details.acnt_zipcode %>" /><br />

      <label class="" >Country</label>
      <%= selects.countries('', 'd[acnt_country]', details.acnt_country) %>
      <br />
      <label>Timezone</label>
      <%= selects.timezones('', 'd[acnt_timezone]', details.acnt_timezone) %>
      <br />
      <label class="" >Account Settings <em>YAML Config</em></label>
      <textarea name="d[acnt_settings]" cols="55" rows="24" style="font-family:'Courier New', Courier, monospace"><%= details.acnt_settings %></textarea>
      <br />
      <div class="formfooter">
      <input value="Save" type="submit" class="">
      </div>
      <br />
      <br />
      <br />
      <br />
  </form>

  <% if details.accountid %>
  <h3><a name="access"></a>
  Account Access
  </h3>
  <hr>
  <% if details.Access %>
  <% for item in details.Access %>
  <a class="page SqueezeBox" rel="add" href="<%= Uri.path %>/<%= details.accountid %>/access/<%= item.accessid %>">
      <h5><%= item.acc_name %></h5>
      <span style="position:absolute; right:10px;"><%= item.status %> <%= (item.acc_typestat AND 2) ? '&bull; Suspended' : ''  %> <%= (item.acc_typestat AND 4) ? '&bull; Pending' : ''  %></span>
      <p>
        <sup><%= item.acc_code %>#<%= item.acc_uid %></sup>
      </p>
      <p><%= item.acc_descr %></p>
  </a>
  <% endfor %>
  <% endif %>
  <a class="page SqueezeBox" rel="add" href="<%= Uri.path %>/<%= details.accountid %>/access/add">
      <h5>Add Access</h5>
  </a>
  <br />
  <div class="form formfooter">
  <input value="Save" type="submit" class="">
  </div>
  <br />
  <br />
  <% endif %>

  <br />
  <br />

<% spaceless %>
<div class="appvar">
{
  account : {
    typestat: <%= details.acnt_typestat|default(0) %>
  }
}
</div>
<% endspaceless %>

<% endblock %>