<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>Nested Document</title>
<style type="text/css">
	html {font-size:62.5%; font-family:verdana;}
	* {margin:0; padding:0;}
	/*
	
	
	h1 {font-size:1.6em;}
	h2 {font-size:1.5em;}
	h3 {font-size:1.4em;}
	h4 {font-size:1.3em;}
	h5 {font-size:1.2em;}
	h6 {font-size:1.1em;}
	input {font-size:1em;}
	pre {overflow:auto; height: 100px; width:90%; background-color:#eee; border:1px solid black;}
	*/
	ol {cursor:pointer; background-color:#fff; margin-top:5px;}
	li {margin-left:3em; cursor:pointer; margin-bottom: 5px;}
	.drag {background-color:#ccc !important;}
	.drag ol {background-color:#ccc !important;}
	.nCollapse {background-color:#ddd; color:red;}
	.unlocked {background-color:#cfc;}
	
	#funnel_filter div{ cursor: pointer}
</style>
<script src='../mootools.v1.11.js'></script>
<script src='../widgets/Nested.js'></script>
<script src='../Remote/Json.js'></script>
<script language="javascript">
	var page ={
		dragit: {
			mousedown: function(e){
				e = new Event(e).stop();
				var clone = this.clone()
					.setStyles(this.getCoordinates()) // this returns an object with left/top/bottom/right, so its perfect
					.setStyles({'opacity': 0.7, 'position': 'absolute'})
					//.setProperty('title', this.id)
					//.setProperty('id', '')
					.addEvent('emptydrop', function() {
						this.remove();
					}).inject(document.body);
					
				var dropables = $$('#drophere');
				
				clone.makeDraggable({
					droppables: dropables
				}).start(e); // this returns the dragged element
			}	
		}
	};
	
	
	var DumpIt = function() {
		var theDump = sortIt.serialize();
		$('debug').setHTML(Json.toString(theDump));
	};
	
	var InsertIt = function() {
		var li = new Element('li').setProperty('id', $('id').value).appendText($('text').value).injectInside($('example'));
	};
	
	var LockIt = function() {
		sortIt.options.lock = ($('locking').value.length == 0) ? null : $('locking').value;
	};
	
	var sortIt;
	window.addEvent('domready', function() {
		sortIt = new Nested('funnel', {
			collapse: false,
			onStart: function(el) {
				el.addClass('drag');
			},
			onComplete: function(el) {
				el.removeClass('drag');
				DumpIt();
			}
		});
		/*
		$('locking').addEvent('change', LockIt);
		$('insert').addEvent('click', InsertIt);
		$('dump').addEvent('click', DumpIt);
		*/
		
		$$('#funnel li').each(function(el){					
			el.addEvents({
				dblclick: function(e){
					e = new Event(e).stop();
					if (!confirm('Continue to remove this element "'+el.title+'"')) return
					el.remove();
				}
			});
		});
		
		$$('#funnel_filter div').each(function(drag){

			drag.addEvents(page.dragit);
			
			
		});
		
		var drop = $('drophere');

		drop.addEvents({
			'over': function(el, obj){
				this.setStyle('border-color', '#888');
			},
			'leave': function(el, obj){
				this.setStyle('border-color', '#efefef');
			},
			'drop': function(el, obj){
				var li = new Element('li')
				.setProperty('id', el.id)
				.setProperty('title',el.innerHTML)
				.appendText(el.innerHTML)
				.addEvents({
					dblclick: function(e){
						e = new Event(e).stop();
						if (!confirm('Continue to remove this element "'+el.title+'"')) return
						el.remove();
					}
				})
				.injectInside($('funnel'));
				
				el.remove();
				this.setStyle('border-color', '#efefef');
				
			}
		});

		
	});

</script>
</head>

<body>
	<ol id="example">
		<li id="item1">Item 1</li>
		<li id="item2">Item 2</li>
		<li id="item3">Item 3
			<ol>
				<li id="item3-2">[<a class="remove" onclick="alert('ok');">x</a>] Item 3.2 ( 78956 )</li>
				<li id="item3-3">Item 3.3
					<ol>
						<li id="item3-3-1">Item 3.3.1<br />
							A little extra text to make things different.						</li>
						<li id="item3-3-2">Item 3.3.2</li>

						<li id="item3-3-3">Item 3.3.3
							<ol>
								<li id="item3-3-3-1">Item 3.3.3.1</li>
							</ol>
						</li>
					</ol>
				</li>
			</ol>
		</li>

		<li id="item4">Item 4</li>
		<li id="item5" class="unlocked">Item 5
			<ol>
				<li id="item5-1">Item 5.1</li>
				<li id="item5-2">Item 5.2</li>
				<li id="item5-3"><h3>Item 5.3</h3></li>
			</ol>
		</li>
		<li id="item16"><strong>Item 6</strong></li>
		<li id="item17">Item 7</li>
		<li id="item18">Item 8</li>
		<li id="item19"><em>Item 9</em></li>
		<li id="item10" class="unlocked">Item 10</li>

		<li id="item11">Item 11</li>
    </ol>
    <p>&nbsp;</p>		
    <p><hr></p>
    <p>&nbsp;</p>	
	
	<div id="drophere" style="border: 1px dashed #efefef; padding:10px; margin:10px;">
	
	<ol id="funnel">
		<li id="1">Path1</li>
		<li id="2">Path2</li>
		<li id="3">Path3</li>
		<li id="4">Path4</li>
		<li id="5">Path5</li>
		<li id="1">Path6</li>
		<li id="2">Path7</li>
		<li id="3">Path8</li>
		<li id="4">Path9</li>
		<li id="5">Path10</li>	
		<li id="item3-2">Item 3.2 ( 78956 )</li>			
	</ol>
	
	</div>
	
	<div id="funnel_filter">
		<div id="1">Path1</div>
		<div id="2">Path2</div>
		<div id="3">Path3</div>
		<div id="4">Path4</div>
		<div id="5">Path5</div>
		<div id="1">Path6</div>
		<div id="2">Path7</div>
		<div id="3">Path8</div>
		<div id="4">Path9</div>
		<div title="Path10" id="5">Path10</div>				
	</div>
	
	
	
    <p>&nbsp;</p>		
    <p><hr></p>
    <p>&nbsp;</p>	
	<div id="debug"></div>	
</body>
</html>
